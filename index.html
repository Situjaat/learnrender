<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>
    <style>
        /* CSS styles here */
        #form {
            max-width: 400px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        input[type="text"],input[type="url"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        #pic{
            width: 60%;
            height: auto;
        }
        #cont{
    display: grid;
    grid-template-columns: repeat(4,1fr);
    gap: 20px; 
    text-align: center;      
        }
        #box1{
        display: flex;
        flex-wrap: wrap;
        margin-left: 140px;
        margin-top: 20px;
        text-align: center;
        padding: 10px;
    
        }
        #box{
            border: 1px solid rgb(125, 185, 203);
            border-radius: 10px;
            text-align: center;
        }
        #edit{
            margin-right: 30px;
            background-color: darkgreen;
            width: 60px;
        }
        #delete{
            background-color: red;
            width: 75px;
            margin-left: 30px;
        }

        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:active {
            background-color: #0056b3;
        }

        button:focus {
            outline: none;
        }

        
    </style>
</head>
<body>
    <form id="form">
        Name: <input type="text" id="name"><br><br>
        Email: <input type="text" id="email"><br><br>
        Photo: <input type="url" id="photo"><br><br>
        <button id="btn">Submit</button>
    </form>

    <div id="cont"></div>

 
    </table>

    <script>
        let form = document.getElementById("form");
        let nameInput = document.getElementById("name");
        let emailInput = document.getElementById("email");
        let photoInput = document.getElementById("photo");
        let state = false;
        let arr = [];
        let currentid = null; // Track current edit id

        async function postdata() {
            let obj = {
                name: nameInput.value,
                email: emailInput.value,
                photo: photoInput.value
            };
            try {
                let res = await axios.post("https://jason-server-new.onrender.com/data", obj);
                console.log(res.data);
                getdata();
                form.reset();
            } catch (error) {
                console.log(error);
            }
        }

        async function getdata() {
            try {
                let res = await axios.get("https://jason-server-new.onrender.com/data");
                arr = res.data;
                displaydata();
            } catch (error) {
                console.log(error);
            }
        }

        async function displaydata() {
           let cont = document.getElementById("cont");
           cont.innerHTML = "";

            arr.forEach(ele => {
                let div = document.createElement("div");
                 div.id="box"
                let name = document.createElement("h1");
                name.innerText = ele.name;

                let email = document.createElement("h3");
                email.innerText = ele.email;

                let photo=document.createElement("img")
                photo.src=ele.photo;
                photo.id="pic"
                
                let div1=document.createElement("div")
                div1.id="box1"
                
                let editBtn = document.createElement("button");
                editBtn.innerText = "Edit";
                editBtn.id="edit"
                editBtn.classList.add("table-button");
                editBtn.addEventListener("click", () => {
                    getdataforedit(ele);
                });

                let deleteBtn = document.createElement("button");
                deleteBtn.innerText = "Delete";
                deleteBtn.id="delete"
                deleteBtn.classList.add("table-button");
                deleteBtn.addEventListener("click", () => {
                    deletdata(ele.id);
                });
                cont.append(div)
                div1.append(editBtn, deleteBtn)
                div.append(name, email, photo,div1);
            });
        }

        async function deletdata(id) {
            try {
                let res = await axios.delete(`https://jason-server-new.onrender.com/data/${id}`);
                console.log(res.data);
                getdata();
                alert("Deleted successfully.");
            } catch (error) {
                console.log(error);
            }
        }

        function getdataforedit(data) {
            nameInput.value = data.name;
            emailInput.value = data.email;
            photoInput.value = data.photo;
            currentid = data.id;
            state = true;
            btn.innerText = "Update";
        }

        async function updatedata() {
            let updateobj = {
                name: nameInput.value,
                email: emailInput.value,
                photo: photoInput.value
            };
            try {
                let res = await axios.patch(`https://jason-server-new.onrender.com/data/${currentid}`, updateobj);
                console.log(res.data);
                alert("Updated successfully.");
                getdata();
                form.reset();
                btn.innerText = "Submit";
                state = false;
            } catch (error) {
                console.log(error);
            }
        }

        let btn = document.getElementById("btn");
        btn.addEventListener("click", (e) => {
            e.preventDefault();
            if (state) {
                updatedata();
            } else {
                postdata();
            }
        });

        // Initial data fetch
        getdata();
    </script>
</body>
</html>
